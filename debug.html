<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Supabase Connection</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; }
        .debug-info { background: #f5f5f5; padding: 20px; border-radius: 8px; margin: 20px 0; }
        .error { background: #fee; border-left: 4px solid #f00; }
        .success { background: #efe; border-left: 4px solid #0f0; }
        button { background: #007cba; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #005a8b; }
        pre { background: #f8f8f8; padding: 10px; border-radius: 4px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>SocialSage Supabase Debug Tool</h1>
    
    <p>This tool helps debug the Supabase connection issue. Click the buttons below to test different endpoints:</p>
    
    <button onclick="testConnection()">Test Supabase Connection</button>
    <button onclick="testWaitlistSubmission()">Test Waitlist Submission</button>
    <button onclick="viewWaitlistData()">View Recent Signups</button>
    
    <div id="results"></div>

    <script>
        async function testConnection() {
            showLoading();
            try {
                const response = await fetch('/api/test-connection');
                const data = await response.json();
                showResult(data, response.ok ? 'success' : 'error');
            } catch (error) {
                showResult({ error: 'Failed to test connection', details: error.message }, 'error');
            }
        }

        async function testWaitlistSubmission() {
            showLoading();
            const testData = {
                email: 'test@example.com',
                instagram: '@testuser',
                goals: 'Testing the waitlist submission functionality',
                source: 'debug-test'
            };

            try {
                const response = await fetch('/api/waitlist', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(testData)
                });
                const data = await response.json();
                showResult(data, response.ok ? 'success' : 'error');
            } catch (error) {
                showResult({ error: 'Failed to submit test data', details: error.message }, 'error');
            }
        }

        async function viewWaitlistData() {
            showLoading();
            showResult({ 
                message: 'This would require admin access to Supabase dashboard', 
                instructions: [
                    '1. Go to your Supabase project dashboard',
                    '2. Navigate to Table Editor',
                    '3. Select "waitlist_signups" table',
                    '4. Check if there are any records',
                    '5. If no records, the API calls are not reaching the database'
                ]
            }, 'info');
        }

        function showLoading() {
            document.getElementById('results').innerHTML = '<div class="debug-info">Loading...</div>';
        }

        function showResult(data, type) {
            const resultsDiv = document.getElementById('results');
            const className = type === 'success' ? 'debug-info success' : 
                             type === 'error' ? 'debug-info error' : 'debug-info';
            
            resultsDiv.innerHTML = `
                <div class="${className}">
                    <h3>Result (${type})</h3>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                </div>
            `;
        }
    </script>
</body>
</html>